version: 2.1
orbs:
  gh: circleci/github-cli@2.6
jobs:
  build:
    machine:
      image: ubuntu-2404:2024.11.1
    steps:
      - checkout
      - gh/install
      - run: curl -fsSL https://deno.land/install.sh | sh
      - run:
          name: Install CLI Tool
          command: |
            gh release download --repo "levibostian/new-deployment-tool" --pattern "bin-$(uname -m)-$(uname)" --output new-deployment-tool && \
            chmod +x new-deployment-tool
      - run:
          name: Run CLI Tool
          command: |
            ./new-deployment-tool \
              --github_token "$GH_TOKEN" \
              --deploy "./steps/deploy.ts" \
              --get_latest_release_current_branch "./steps/get-latest-release.ts" \
              --get_next_release_version "./steps/get-next-release.ts" \
              --simulated_merge_type "rebase"
workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build
